# 图像水印实验报告

## 1. 实验目的与背景

本实验旨在实现一种基于 DCT（离散余弦变换）的数字图像水印嵌入与提取方法，并评估其在各种图像攻击下的鲁棒性。具体目标包括：

1. 理解 DCT 域水印嵌入原理。
2. 掌握水印嵌入强度与图像质量（PSNR）之间的平衡。
3. 实现水印从受攻击图像中的提取，验证鲁棒性。
4. 分析不同图像攻击（噪声、压缩、旋转、裁剪等）对水印提取效果的影响。

**背景**：
数字水印技术用于版权保护、篡改检测和图像认证，常见方法包括时域直接嵌入和频域嵌入。DCT 域嵌入通过修改图像块的中频系数，可在保证视觉质量的前提下提高鲁棒性。

---

## 2. 算法与数学表示

### 2.1 水印生成

水印为随机二值矩阵：

$$
W \in \{0,1\}^{m \times n}
$$

其中 $m$ 和 $n$ 为水印图像的高和宽。
为保证可重现性，采用固定随机种子生成。

### 2.2 水印嵌入

1. 将宿主图像 $I_{host}$ 转换为 YUV 颜色空间，选取 Y 通道 $Y$。

$$
Y = f(I_{host})
$$

2. 将 Y 通道划分为 $8 \times 8$ 块，并对每块进行 DCT：

$$
B = DCT(Y_{i,j})
$$

3. 在中频系数 $(u,v) = (3,4)$ 嵌入水印位：

$$
B(u,v) = 
\begin{cases} 
B(u,v) \cdot (1 + \alpha), & \text{若水印位 } W(i,j) = 1 \\
B(u,v) \cdot (1 - \alpha), & \text{若水印位 } W(i,j) = 0
\end{cases}
$$

其中 $\alpha$ 为水印嵌入强度（`watermark_intensity`）。

4. 对修改后的 DCT 块进行逆 DCT：

$$
Y'_{i,j} = IDCT(B)
$$

5. 合并所有块，重构 Y 通道，并转换回 BGR 图像：

$$
I_{watermarked} = f^{-1}(Y')
$$

### 2.3 水印提取

提取过程基于密钥 `key`（记录每个位的 DCT 块位置）：

1. 对水印嵌入位置的 DCT 块提取中频系数：

$$
B(u,v)
$$

2. 根据符号判断水印位：

$$
\hat{W}(i,j) = 
\begin{cases} 
1, & B(u,v) > 0 \\
0, & B(u,v) \le 0
\end{cases}
$$

### 2.4 图像质量与相似度

1. \*\*PSNR（峰值信噪比）\*\*衡量水印嵌入后图像质量：

$$
PSNR = 20 \log_{10} \frac{MAX_I}{\sqrt{MSE}}, \quad
MSE = \frac{1}{HW}\sum_{i,j}(I_{host}(i,j)-I_{watermarked}(i,j))^2
$$

2. **水印相似度**通过比特错误率 (BER) 计算：

$$
Similarity = 1 - \frac{\sum_{i,j} \mathbf{1}[W(i,j) \neq \hat{W}(i,j)]}{m \cdot n}
$$

---

## 3. 实现思路

1. **水印嵌入**

   * 使用 `cv2.cvtColor` 将宿主图像转到 YUV。
   * 计算每个水印位对应的宿主图像块。
   * 在 DCT 块中选择中频系数嵌入水印。
   * 记录嵌入位置作为密钥，以便后续提取。

2. **水印提取**

   * 根据密钥提取每个位的 DCT 块。
   * 判断中频系数符号还原水印。

3. **攻击模拟**

   * 添加高斯噪声。
   * JPEG 压缩（50%质量）。
   * 图像几何操作（旋转、水平翻转、裁剪）。
   * 亮度与对比度调整。
   * 模糊与缩放。
   * 统计每种攻击后的水印相似度。

---

## 4. 实验流程

1. 加载宿主图像（或创建示例图像）。
2. 生成水印图像（尺寸为宿主图像的 1/8）。
3. 嵌入水印，计算嵌入后 PSNR。
4. 对含水印图像应用各种攻击。
5. 提取水印并计算相似度。
6. 可视化结果：

   * 原始图像、水印、含水印图像。
   * 攻击后的图像及提取水印。
   * 水印相似度柱状图。

---

## 5. 预期实验结果

1. **嵌入效果**

   * PSNR 约 38\~42 dB（水印强度 0.15），视觉质量较高。
   * 含水印图像与原图差异不明显。

2. **鲁棒性**

   | 攻击类型      | 预期相似度      |
   | --------- | ---------- |
   | 原始图像      | 1.000      |
   | 高斯噪声      | 0.85\~0.95 |
   | JPEG压缩50% | 0.80\~0.90 |
   | 水平翻转      | 0.70\~0.80 |
   | 旋转5度      | 0.75\~0.85 |
   | 裁剪边缘      | 0.60\~0.75 |
   | 对比度调整     | 0.85\~0.95 |
   | 高斯模糊      | 0.75\~0.85 |
   | 缩放50%     | 0.65\~0.80 |
   | 亮度增加      | 0.85\~0.95 |

3. **观察**

   * DCT 中频嵌入可有效抵抗轻度压缩和噪声。
   * 几何变换和裁剪会降低相似度。
   * 强光照、对比度和模糊攻击对水印影响中等。

---

## 6. 总结与展望

* 本实验展示了基于 DCT 域的盲水印嵌入和提取方法。
* 通过调整水印强度和选择中频系数，可在保证图像质量的同时增强鲁棒性。

  * 原始图像
  * 水印图像
  * 含水印图像
  * 各类攻击后的图像及提取水印
  * 水印相似度柱状图
